# cBioPortal Meta-analysis Pipeline

**Status (mar25)**: early development

A pipeline to create some useful derived datasets and visualizations using the [cBioPortal](https://cbioportal.org) data.

At present, the pipeline is focused on mutation data, but this will be expanded in the near future
to include other data modalities.

# Usage

To run the pipeline, start by cloning the pipeline repo, and creating a conda environment with
the required dependencies.

E.g., using [micromamba](https://mamba.readthedocs.io/en/latest/installation/micromamba-installation.html
):

```
git clone https://github.com/khughitt/cbioportal-meta-pipeline
cd cbioportal-meta-pipeline

micromamba create -n cbioportal --file requirements.txt
```

Activate the environment:

```
micromamba activate cbioportal
```

Use one of the example config files in the "config" dir, or create your own config file with the
same structure.

Finally, use [Snakemake](https://snakemake.readthedocs.io/en/stable/) to run the pipeline,
specififying the config file you wish to use.

For example, to launch Snakemake with a single thread:

```
snakemake -j1 --configfile config/config-10k-genes.yml
```

_Note_: whereas most of the datasets can be downloaded directly by the pipeline, the AACR GENIE
dataset requires users to have an account on synapse.org, and the data must be downloaded and added
to the pipeline input directory manually. For more information, see the [AACR GENIE project page on
synapse.org](https://www.synapse.org/Synapse:syn21683345).

# Pipeline output

Datasets generated by the pipeline fall into two main categories:

1. Data relating to a single study (`studies/`)
2. Data combining information across studies (`summary/`)

Example of study-level data outputs:

```
├── mut
│   ├── gene_cancer.feather
│   ├── gene_patient.feather
│   └── mut.feather
├── metadata
│   ├── dataset.feather
│   ├── samples.feather
│   └── patients.feather
├── freq
│   ├── gene_cancer.feather
│   ├── gene.feather
│   ├── cancer.feather
│   └── cancer_detailed.feather
└── cor
    ├── gene.feather
    └── cancer.feather
```

Structure of combined / "summary" output:

```
├── freq
│   ├── num
│   │   ├── gene_cancer_dataset.feather
│   │   ├── gene_dataset.feather
│   │   ├── cancer_detailed_dataset.feather
│   │   └── cancer_dataset.feather
│   └── ratio
│       ├── gene_cancer_dataset.feather
│       ├── gene_dataset.feather
│       ├── cancer_detailed_dataset.feather
│       └── cancer_dataset.feather
├── datasets.feather
└── summary.html
```
